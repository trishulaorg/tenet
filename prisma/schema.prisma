datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
  referentialIntegrity = "prisma"
}

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["referentialIntegrity"]
}

model User {
  id        Int       @id @default(autoincrement())
  createdAt DateTime  @default(now())
  token     String    @unique
  personas  Persona[]
}

model Persona {
  id               Int               @id @default(autoincrement())
  createdAt        DateTime          @default(now())
  name             String            @unique @db.VarChar(25)
  screenName       String            @db.VarChar(50)
  iconUrl          String            @db.Text
  followingBoards  Board[]           @relation("FollowingBoards")
  modelatingBoards Board[]           @relation()
  followingUsers   PersonaRelation[] @relation("destPersona")
  followedUsers    PersonaRelation[] @relation("srcPersona")
  votesOnComments  VoteOnComment[]
  votesOnPosts     VoteOnPost[]
  user             User              @relation(fields: [userId], references: [id])
  userId           Int
  posts            Post[]
  threads          Thread[]
  replies          Reply[]
}

model PersonaRelation {
  id            Int      @id @default(autoincrement())
  createdAt     DateTime @default(now())
  srcPersonaId  Int
  srcPersona    Persona  @relation("srcPersona", fields: [srcPersonaId], references: [id])
  destPersonaId Int
  destPersona   Persona  @relation("destPersona", fields: [destPersonaId], references: [id])
}

model VoteOnPost {
  id          Int      @id @default(autoincrement())
  createdAt   DateTime @default(now())
  createdById Int
  createdBy   Persona  @relation(fields: [createdById], references: [id])
  weight      Int
}

model VoteOnComment {
  id          Int      @id @default(autoincrement())
  createdAt   DateTime @default(now())
  createdById Int
  createdBy   Persona  @relation(fields: [createdById], references: [id])
  weight      Int
}

model Board {
  id          String    @id @db.VarChar(26)
  title       String    @unique  @db.VarChar(50)
  createdAt   DateTime  @default(now())
  description String    @db.VarChar(2000)
  moderators  Persona[] @relation()
  followedBy  Persona[] @relation("FollowingBoards")
  posts       Post[]
  threads     Thread[]
}

model Post {
  id          String      @id @db.VarChar(26)
  createdAt   DateTime    @default(now())
  title       String      @db.VarChar(50)
  contentType ContentType
  content     String      @db.VarChar(2000)
  threads     Thread[]
  board       Board       @relation(fields: [boardId], references: [id])
  boardId     String
  persona     Persona     @relation(fields: [personaId], references: [id])
  personaId   Int
  attachements PostAttachment[]
}

model Thread {
  id          String      @id @db.VarChar(26)
  createdAt   DateTime    @default(now())
  content     String      @db.VarChar(500)
  contentType ContentType
  replies     Reply[]
  board       Board       @relation(fields: [boardId], references: [id])
  boardId     String
  postId      String
  Post        Post        @relation(fields: [postId], references: [id])
  persona     Persona     @relation(fields: [personaId], references: [id])
  personaId   Int
}

model Reply {
  id          String    @id @db.VarChar(26)
  contentType ContentType
  content     String      @db.VarChar(500)
  createdAt   DateTime    @default(now())
  thread      Thread      @relation(fields: [threadId], references: [id])
  threadId    String
  persona     Persona     @relation(fields: [personaId], references: [id])
  personaId   Int
}

model PostAttachment {
  id String @id @db.VarChar(26)
  postId      String
  post        Post @relation(fields: [postId], references: [id])
  src String 
}

enum ContentType {
  TEXT
  LINK
  IMAGE
  VIDEO
  EMOJI
}
